{"files":{"pxt.json":"{\n    \"name\": \"midi\",\n    \"version\": \"2.2.0\",\n    \"description\": \"A MIDI output controller package\",\n    \"license\": \"MIT\",\n    \"dependencies\": {\n        \"core\": \"*\"\n    },\n    \"files\": [\n        \"README.md\",\n        \"midi.ts\",\n        \"instruments.ts\",\n        \"drums.ts\"\n    ],\n    \"testFiles\": [\n        \"tests.ts\"\n    ],\n    \"public\": true,\n    \"supportedTargets\": [\n        \"microbit\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n","README.md":"# MIDI [![Build Status](https://travis-ci.org/Microsoft/pxt-midi.svg?branch=master)](https://travis-ci.org/Microsoft/pxt-midi)\n\nEmulates a MIDI output controller.\n\n## Usage\n\n### Setup\n\nYou will need to connect a MIDI via serial, radio or bluetooth get it to \"talk\" to the MIDI output device.\n\n* for Bluetooth, use the [bluetooth midi package](https://pxt.microbit.org/pkg/microsoft/pxt-bluetooth-midi).\n\n* for bridge applications like [Hairless MIDI](http://projectgus.github.io/hairless-midiserial/), call ``useRawSerial``\n\n```block\nmidi.useRawSerial()\n```\n\n### Playing tones\n\nPlace a ``||midi play tone||`` block to play a single note (on channel **1**). \nThe frequency is mapped to the nearest note.\n\n```block\nmidi.playTone(Note.A, music.beat(BeatFraction.Whole))\n```\n\n### Tone on / off\n\nPlace a ``||midi tone on||`` block to start a tone (on channel **1**).\nPlace a ``||midi tone off||`` to turn it off.\n\n```block\nmidi.toneOn(Note.A)\nmidi.toneOn(Note.B)\nbasic.pause(music.beat())\nmidi.toneOff(Note.A)\nmidi.toneOff(Note.B)\n```\n\n### Drums\n\nPlace a ``||midi play drum||`` block to play a drum sound. This blocks plays sounds on channel **10** which is reserved for drums.\n\n```block\nmidi.playDrum(DrumSound.HandClap)\n```\n\n### Pitch bending\n\nPlace a ``||midi pitch bend||`` block to applying a sound bending effect to channel **1**.\n\n```block\nmidi.pitchBend(8192 + input.acceleration(Dimension.X) * 8)\n```\n\n### Channels\n\nYou can access and manipulate individual channels using the ``||midi channel||`` block.\nChannels are indexed from **1 to 16** and mapped internally to **0..15**.\n\n```block\nlet piano = midi.channel(1);\n```\n\n#### play a note\n\n```block\nlet piano = midi.channel(1);\npiano.note(30, music.beat(BeatFraction.Whole));\n```\n\n#### play a note on / off\n\n```block\nlet piano = midi.channel(1);\npiano.noteOn(30);\nbasic.pause(100)\npiano.noteOff(30)\n```\n\n### change instrument\n\n```block\nlet trumpet = midi.channel(2);\ntrumpet.setInstrument(MidiInstrument.Trumpet);\n```\n\n#### change pitch bend\n\nThe pitch bend expects values between ``0..16383`` where ``8192`` means no bend.\n\n```block\nlet piano = midi.channel(1);\npiano.pitchBend(8192 + input.acceleration(Dimension.X) * 8)\n```\n\n## Radio serial\n\nYou can use radio to send MIDI messages from various @boardname@ and play them via  [Hairless MIDI](http://projectgus.github.io/hairless-midiserial/).\n\n```typescript\nradio.setGroup(10)\n// routes all radio messages via radio\nmidi.setTransport(function (data: Buffer) {\n    led.toggle(3, 4)\n    radio.sendBuffer(data);\n})\n\n// proxies all radio buffers to serial\nradio.onReceivedBuffer(function (buffer: Buffer) {\n    serial.writeBuffer(buffer);\n    led.toggle(4, 4);\n})\n\n// test send message\ninput.onButtonPressed(Button.A, function () {\n    led.toggle(0, 0)\n    midi.playTone(Note.C, 500)\n})\n```\n\n## License\n\nMIT\n\n## Supported targets\n\n* for PXT/microbit\n* for PXT/calliope\n\n(The metadata above is needed for package search.)\n\n## Code of Conduct\n\nThis project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/). For more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or contact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.\n","instruments.ts":"enum MidiInstrument {\n    //% block=\"Acoustic Grand Piano\" enumval=1\n    AcousticGrandPiano = 1,\n    //% block=\"Bright Acoustic Piano\" enumval=2\n    BrightAcousticPiano = 2,\n    //% block=\"Electric Grand Piano\" enumval=3\n    ElectricGrandPiano = 3,\n    //% block=\"Honky-tonk Piano\" enumval=4\n    HonkytonkPiano = 4,\n    //% block=\"Electric Piano 1\" enumval=5\n    ElectricPiano1 = 5,\n    //% block=\"Electric Piano 2\" enumval=6\n    ElectricPiano2 = 6,\n    //% block=\"Harpsichord\" enumval=7\n    Harpsichord = 7,\n    //% block=\"Clavi\" enumval=8\n    Clavi = 8,\n    //% block=\"Celesta\" enumval=9\n    Celesta = 9,\n    //% block=\"Glockenspiel\" enumval=10\n    Glockenspiel = 10,\n    //% block=\"Music Box\" enumval=11\n    MusicBox = 11,\n    //% block=\"Vibraphone\" enumval=12\n    Vibraphone = 12,\n    //% block=\"Marimba\" enumval=13\n    Marimba = 13,\n    //% block=\"Xylophone\" enumval=14\n    Xylophone = 14,\n    //% block=\"Tubular Bells\" enumval=15\n    TubularBells = 15,\n    //% block=\"Dulcimer\" enumval=16\n    Dulcimer = 16,\n    //% block=\"Drawbar Organ\" enumval=17\n    DrawbarOrgan = 17,\n    //% block=\"Percussive Organ\" enumval=18\n    PercussiveOrgan = 18,\n    //% block=\"Rock Organ\" enumval=19\n    RockOrgan = 19,\n    //% block=\"Church Organ\" enumval=20\n    ChurchOrgan = 20,\n    //% block=\"Reed Organ\" enumval=21\n    ReedOrgan = 21,\n    //% block=\"Accordion\" enumval=22\n    Accordion = 22,\n    //% block=\"Harmonica\" enumval=23\n    Harmonica = 23,\n    //% block=\"Tango Accordion\" enumval=24\n    TangoAccordion = 24,\n    //% block=\"Acoustic Guitar (nylon)\" enumval=25\n    AcousticGuitarNylon = 25,\n    //% block=\"Acoustic Guitar (steel)\" enumval=26\n    AcousticGuitarSteel = 26,\n    //% block=\"Electric Guitar (jazz)\" enumval=27\n    ElectricGuitarJazz = 27,\n    //% block=\"Electric Guitar (clean)\" enumval=28\n    ElectricGuitarClean = 28,\n    //% block=\"Electric Guitar (muted)\" enumval=29\n    ElectricGuitarMuted = 29,\n    //% block=\"Overdriven Guitar\" enumval=30\n    OverdrivenGuitar = 30,\n    //% block=\"Distortion Guitar\" enumval=31\n    DistortionGuitar = 31,\n    //% block=\"Guitar harmonics\" enumval=32\n    GuitarHarmonics = 32,\n    //% block=\"Acoustic Bass\" enumval=33\n    AcousticBass = 33,\n    //% block=\"Electric Bass (finger)\" enumval=34\n    ElectricBassFinger = 34,\n    //% block=\"Electric Bass (pick)\" enumval=35\n    ElectricBassPick = 35,\n    //% block=\"Fretless Bass\" enumval=36\n    FretlessBass = 36,\n    //% block=\"Slap Bass 1\" enumval=37\n    SlapBass1 = 37,\n    //% block=\"Slap Bass 2\" enumval=38\n    SlapBass2 = 38,\n    //% block=\"Synth Bass 1\" enumval=39\n    SynthBass1 = 39,\n    //% block=\"Synth Bass 2\" enumval=40\n    SynthBass2 = 40,\n    //% block=\"Violin\" enumval=41\n    Violin = 41,\n    //% block=\"Viola\" enumval=42\n    Viola = 42,\n    //% block=\"Cello\" enumval=43\n    Cello = 43,\n    //% block=\"Contrabass\" enumval=44\n    Contrabass = 44,\n    //% block=\"Tremolo Strings\" enumval=45\n    TremoloStrings = 45,\n    //% block=\"Pizzicato Strings\" enumval=46\n    PizzicatoStrings = 46,\n    //% block=\"Orchestral Harp\" enumval=47\n    OrchestralHarp = 47,\n    //% block=\"Timpani\" enumval=48\n    Timpani = 48,\n    //% block=\"String Ensemble 1\" enumval=49\n    StringEnsemble1 = 49,\n    //% block=\"String Ensemble 2\" enumval=50\n    StringEnsemble2 = 50,\n    //% block=\"SynthStrings 1\" enumval=51\n    SynthStrings1 = 51,\n    //% block=\"SynthStrings 2\" enumval=52\n    SynthStrings2 = 52,\n    //% block=\"Choir Aahs\" enumval=53\n    ChoirAahs = 53,\n    //% block=\"Voice Oohs\" enumval=54\n    VoiceOohs = 54,\n    //% block=\"Synth Voice\" enumval=55\n    SynthVoice = 55,\n    //% block=\"Orchestra Hit\" enumval=56\n    OrchestraHit = 56,\n    //% block=\"Trumpet\" enumval=57\n    Trumpet = 57,\n    //% block=\"Trombone\" enumval=58\n    Trombone = 58,\n    //% block=\"Tuba\" enumval=59\n    Tuba = 59,\n    //% block=\"Muted Trumpet\" enumval=60\n    MutedTrumpet = 60,\n    //% block=\"French Horn\" enumval=61\n    FrenchHorn = 61,\n    //% block=\"Brass Section\" enumval=62\n    BrassSection = 62,\n    //% block=\"SynthBrass 1\" enumval=63\n    SynthBrass1 = 63,\n    //% block=\"SynthBrass 2\" enumval=64\n    SynthBrass2 = 64,\n    //% block=\"Soprano Sax\" enumval=65\n    SopranoSax = 65,\n    //% block=\"Alto Sax\" enumval=66\n    AltoSax = 66,\n    //% block=\"Tenor Sax\" enumval=67\n    TenorSax = 67,\n    //% block=\"Baritone Sax\" enumval=68\n    BaritoneSax = 68,\n    //% block=\"Oboe\" enumval=69\n    Oboe = 69,\n    //% block=\"English Horn\" enumval=70\n    EnglishHorn = 70,\n    //% block=\"Bassoon\" enumval=71\n    Bassoon = 71,\n    //% block=\"Clarinet\" enumval=72\n    Clarinet = 72,\n    //% block=\"Piccolo\" enumval=73\n    Piccolo = 73,\n    //% block=\"Flute\" enumval=74\n    Flute = 74,\n    //% block=\"Recorder\" enumval=75\n    Recorder = 75,\n    //% block=\"Pan Flute\" enumval=76\n    PanFlute = 76,\n    //% block=\"Blown Bottle\" enumval=77\n    BlownBottle = 77,\n    //% block=\"Shakuhachi\" enumval=78\n    Shakuhachi = 78,\n    //% block=\"Whistle\" enumval=79\n    Whistle = 79,\n    //% block=\"Ocarina\" enumval=80\n    Ocarina = 80,\n    //% block=\"Lead 1 (square)\" enumval=81\n    LeadSquare = 81,\n    //% block=\"Lead 2 (sawtooth)\" enumval=82\n    LeadSawtooth = 82,\n    //% block=\"Lead 3 (calliope)\" enumval=83\n    LeadCalliope = 83,\n    //% block=\"Lead 4 (chiff)\" enumval=84\n    LeadChiff = 84,\n    //% block=\"Lead 5 (charang)\" enumval=85\n    LeadCharang = 85,\n    //% block=\"Lead 6 (voice)\" enumval=86\n    LeadVoice = 86,\n    //% block=\"Lead 7 (fifths)\" enumval=87\n    LeadFifths = 87,\n    //% block=\"Lead 8 (bass + lead)\" enumval=88\n    LeadBassLead = 88,\n    //% block=\"Pad 1 (new age)\" enumval=89\n    PadNewAge = 89,\n    //% block=\"Pad 2 (warm)\" enumval=90\n    PadWarm = 90,\n    //% block=\"Pad 3 (polysynth)\" enumval=91\n    PadPolysynth = 91,\n    //% block=\"Pad 4 (choir)\" enumval=92\n    PadChoir = 92,\n    //% block=\"Pad 5 (bowed)\" enumval=93\n    PadBowed = 93,\n    //% block=\"Pad 6 (metallic)\" enumval=94\n    PadMetallic = 94,\n    //% block=\"Pad 7 (halo)\" enumval=95\n    PadHalo = 95,\n    //% block=\"Pad 8 (sweep)\" enumval=96\n    PadWweep = 96,\n    //% block=\"FX 1 (rain)\" enumval=97\n    FXRain = 97,\n    //% block=\"FX 2 (soundtrack)\" enumval=98\n    FXSoundtrack = 98,\n    //% block=\"FX 3 (crystal)\" enumval=99\n    FXCrystal = 99,\n    //% block=\"FX 4 (atmosphere)\" enumval=100\n    FXAtmosphere = 100,\n    //% block=\"FX 5 (brightness)\" enumval=101\n    FXBrightness = 101,\n    //% block=\"FX 6 (goblins)\" enumval=102\n    FXGoblins = 102,\n    //% block=\"FX 7 (echoes)\" enumval=103\n    FXEchoes = 103,\n    //% block=\"FX 8 (sci-fi)\" enumval=104\n    FXSciFi = 104,\n    //% block=\"Sitar\" enumval=105\n    Sitar = 105,\n    //% block=\"Banjo\" enumval=106\n    Banjo = 106,\n    //% block=\"Shamisen\" enumval=107\n    Shamisen = 107,\n    //% block=\"Koto\" enumval=108\n    Koto = 108,\n    //% block=\"Kalimba\" enumval=109\n    Kalimba = 109,\n    //% block=\"Bag pipe\" enumval=110\n    Bagpipe = 110,\n    //% block=\"Fiddle\" enumval=111\n    Fiddle = 111,\n    //% block=\"Shanai\" enumval=112\n    Shanai = 112,\n    //% block=\"Tinkle Bell\" enumval=113\n    TinkleBell = 113,\n    //% block=\"Agogo\" enumval=114\n    Agogo = 114,\n    //% block=\"Steel Drums\" enumval=115\n    SteelDrums = 115,\n    //% block=\"Woodblock\" enumval=116\n    Woodblock = 116,\n    //% block=\"Taiko Drum\" enumval=117\n    TaikoDrum = 117,\n    //% block=\"Melodic Tom\" enumval=118\n    MelodicTom = 118,\n    //% block=\"Synth Drum\" enumval=119\n    SynthDrum = 119,\n    //% block=\"Reverse Cymbal\" enumval=120\n    ReverseCymbal = 120,\n    //% block=\"Guitar Fret Noise\" enumval=121\n    GuitarFretNoise = 121,\n    //% block=\"Breath Noise\" enumval=122\n    BreathNoise = 122,\n    //% block=\"Seashore\" enumval=123\n    Seashore = 123,\n    //% block=\"Bird Tweet\" enumval=124\n    BirdTweet = 124,\n    //% block=\"Telephone Ring\" enumval=125\n    TelephoneRing = 125,\n    //% block=\"Helicopter\" enumval=126\n    Helicopter = 126,\n    //% block=\"Applause\" enumval=127\n    Applause = 127,\n    //% block=\"Gunshot\" enumval=128\n    Gunshot = 128\n}","midi.ts":"enum MidiCommand {\n    //% block=\"tune request\"\n    TuneRequest = 0xf6,\n    //% block=\"timing clock\"\n    TimingClock = 0xf8,\n    //% block=\"start\"\n    Start = 0xfa,\n    //% block=\"continue\"\n    Continue = 0xfb,\n    //% block=\"stop\"\n    Stop = 0xfc,\n    //% block=\"active sensing\"\n    ActiveSensing = 0xfe,\n    //% block=\"reset\"\n    Reset = 0xff\n}\n\nenum MidiChannelMode {\n    //% block=\"all sound off\"\n    AllSoundOff = 120 << 8 | 0,\n    //% block=\"reset all controllers\"\n    ResetAllControllers = 121 << 8 | 0,\n    //% block=\"local control off\"\n    LocalControlOff = 122 << 8 | 0,\n    //% block=\"local control on\"\n    LocalControlOn = 122 << 8 | 127,\n    //% block=\"all notes off\"\n    AllNotesOff = 123 << 8 | 0,\n    //% block=\"omni mode off\"\n    OmniModeOff = 124 << 8 | 0,\n    //% block=\"omni mode on\"\n    OmniModeOn = 125 << 8 | 0,\n    //% block=\"mono mode off\"\n    MonoModeOff = 126 << 8 | 0,\n    //% block=\"mono mode on\"\n    MonoModeOn = 126 << 8 | 1,\n    //% block=\"poly mode on\"\n    PolyModeOn = 127 << 8 | 0\n}\n\n/**\n * Blocks to simulate MIDI instruments.\n */\n//% weight=85 icon=\"\\uf001\" color=\"#5ea9dd\"\n//% groups='[\"Play\", \"Constants\", \"Channels\", \"Transports\"]'\nnamespace midi {\n    /**\n     * Transport needs to be set prior to using MIDI APIs\n     */\n    let transport: (data: Buffer) => void;\n\n    /**\n     * Sets the transport mechanism to send MIDI commands\n     * @param newTransport current transport\n     */\n    //% advanced=true blockHidden=1\n    export function setTransport(newTransport: (data: Buffer) => void) {\n        transport = newTransport;\n    }\n\n    /**\n     * Sends a MIDI message\n     * @param data 1,2 or 3 numbers\n     */\n    //% advanced=true blockHidden=1\n    export function sendMessage(data: number[]) {\n        if (!transport) return;\n\n        const buf = pins.createBuffer(data.length);\n        for (let i = 0; i < data.length; ++i)\n            buf.setNumber(NumberFormat.UInt8LE, i, data[i])\n        control.__midiSend(buf); // simulator support\n        transport(buf);\n    }\n\n    /**\n    * Send raw MIDI messages via serial\n    */\n    //% blockId=midi_raw_serial_transport block=\"midi use raw serial\"\n    //% weight=2 blockGap=8\n    //% group=Transports\n    export function useRawSerial() {\n        function send(data: Buffer): void {\n            serial.writeBuffer(data)\n        }\n        setTransport(send)\n    }\n\n    /**\n     * Send human readable MIDI messages via serial\n     */\n    //% blockId=midi_serial_transport block=\"midi use serial\"\n    //% weight=1 blockGap=8\n    //% group=Transports\n    export function useSerial() {\n        function send(data: Buffer): void {\n            // waiting for beta\n            //const buf = pins.createBuffer(data.length);\n            //for (let i = 0; i < data.length; ++i)\n            //    buf[i] = data[i];\n            // serial.writeBuffer(buf);\n            serial.writeString(\"midi:\")\n            for (let i = 0; i < data.length; ++i) {\n                if (i > 0) serial.writeString(\",\");\n                serial.writeNumber(data[i]);\n            }\n            serial.writeLine(\"\");\n        }\n        setTransport(send)\n    }\n\n    let channels: MidiController[];\n    /**\n     * Gets the MIDI controller for a given channel.\n     * @param channel the selected channel, eg: 1\n     */\n    //% blockId=\"midi_channel\" block=\"midi channel %channel\"\n    //% group=\"Channels\" weight=90 channel.min=1 channel.max=16\n    export function channel(channel: number): MidiController {\n        channel -= 1;\n        channel = Math.max(0, Math.min(15, channel));\n\n        if (!channels) channels = [];\n        let i = channels[channel];\n        if (!i) i = channels[channel] = new MidiController(channel);\n\n        return i;\n    }\n\n    /**\n     * A Output MIDI controller, typically a keyboard.\n     */\n    //%\n    export class MidiController {\n        channel: number;\n        velocity: number;\n\n        constructor(channel: number) {\n            this.channel = channel;\n            this.velocity = 0x7f;\n        }\n\n        /**\n         * Plays a note for the given duration and adds a small pause\n         * @param key key to play between 0 and 127, eg: 69\n         * @param duration duration of play\n         */\n        //% blockId=midi_note block=\"%this|note %key|duration %duration=device_beat\"\n        //% blockGap=8 weight=82\n        //% group=\"Channels\"\n        note(key: number, duration: number): void {\n            key = key >> 0;\n            if (duration > 0) {\n                this.noteOn(key);\n                basic.pause(duration);\n            }\n            this.noteOff(key);\n            basic.pause(6);\n        }\n\n        /**\n         * Starts playing a note\n         * @param key the note to play, eg: 69\n         */\n        //% blockId=midi_note_on block=\"%this|note on %key\"\n        //% key.min=0 key.max=127 velocity.min=0 velocity.max=127\n        //% blockGap=8 weight=81\n        //% group=\"Channels\"\n        noteOn(key: number, velocity = 0): void {\n            key = key >> 0;\n            if (key < 0 || key > 0x7f) return;\n\n            sendMessage([0x90 | this.channel, key, velocity || this.velocity]);\n        }\n\n        /**\n         * Stops playing a note\n         * @param key the note to stop, eg: 69\n         */\n        //% blockId=midi_note_off block=\"%this|note off %key\"\n        //% key.min=0 key.max=127 velocity.min=0 velocity.max=127\n        //% blockGap=8 weight=80\n        //% group=\"Channels\"\n        noteOff(key: number, velocity = 0): void {\n            key = key >> 0;\n            if (key < 0 || key > 0x7f) return;\n\n            sendMessage([0x80 | this.channel, key, velocity || this.velocity]);\n        }\n\n        /**\n         * Sets the instrument on this channel\n         * @param instrument the instrument to select\n         */\n        //% blockId=midi_set_instrument block=\"%this|set instrument %instrument=midi_instrument\"\n        //% instrument.min=0 instrument.max=16\n        //% weight=70\n        //% group=\"Channels\"\n        setInstrument(instrument: number): void {\n            instrument = instrument >> 0;\n            instrument -= 1;\n            if (instrument < 0 || instrument > 0x7f) return;\n\n            sendMessage([0xc0 | this.channel, instrument]);\n        }\n\n        /**\n         * Sets the velocity\n         * @param velocity velocity of the instrument\n         */\n        //% blockId=midi_set_velocity block=\"%this|set velocity %velocity\"\n        //% velocity.min=0 velocity.max=127\n        //% blockGap=8 weight=79\n        //% group=\"Channels\"\n        setVelocity(velocity: number): void {\n            velocity = velocity >> 0;\n            this.velocity = velocity & 0x7f;\n        }\n\n        /**\n         * Sets the pitch on the channel\n         * @param amount current bend, eg: 8192\n         */\n        //% blockGap=8 blockId=midi_set_pitch_bend block=\"%this|set pitch bend %amount\"\n        //% amount.min=0 amount.max=16383  weight=78\n        //% group=\"Channels\"\n        pitchBend(amount: number) {\n            amount = amount >> 0;\n            amount = Math.max(0, amount & 0x3fff);\n            sendMessage([0xe0 | this.channel, amount & 0x7f, (amount >> 7) & 0x7f]);\n        }\n\n        /**\n         * Sends a MIDI command\n         * @param cmd the command to send\n         */\n        //% blockId=midi_command block=\"%this|command $cmd=midi_command_id\"\n        //% blockGap=8\n        //% group=\"Channels\"\n        command(cmd: number) {\n            cmd = cmd >> 0;\n            sendMessage([cmd | this.channel]);\n        }\n\n        /**\n         * This message sent when the patch number changes.\n         * @param program the new program value\n         */\n        //% blockId=midi_program_change block=\"%this|program change to %program\"\n        //% blockGap=8\n        //% group=\"Channels\"\n        //% program.min=0 program.max=127\n        programChange(program: number) {\n            program = program >> 0;\n            sendMessage([0xc0 | this.channel, program & 0x7f]);\n        }\n\n        /**\n         * Channel Pressure (After-touch). This message is most often sent by pressing down on the key after it \"bottoms out\".\n         * This message is different from polyphonic after-touch. Use this message to send the single greatest pressure value (of all the current depressed keys).\n         * @param pressure the pressure value\n         */\n        //% blockId=midi_after_touch block=\"%this|after touch %pressure\"\n        //% blockGap=8\n        //% group=\"Channels\"\n        //% pressure.min=0 pressure.max=127\n        aftertouch(pressure: number) {\n            pressure = pressure >> 0;\n            sendMessage([0xd0 | this.channel, pressure & 0x7f]);\n        }\n\n        /**\n         * Polyphonic Key Pressure (Aftertouch). This message is most often sent by pressing down on the key after it \"bottoms out\".\n         * @param key the note to play\n         * @param pressure the pressure\n         */\n        //% blockId=midi_polyphonic_after_touch block=\"%this|polyphonic after touch %key|%pressure\"\n        //% blockGap=8\n        //% group=\"Channels\"\n        //% key.min=0 key.max=127\n        //% pressure.min=0 pressure.max=127\n        polyphonicAftertouch(key: number, pressure: number) {\n            key = key >> 0;\n            pressure = pressure >> 0;\n            sendMessage([0xa0 | this.channel, key & 0x7f, pressure & 0x7f]);\n        }\n\n        /**\n         * Control Change. This message is sent when a controller value changes. Controllers include devices such as pedals and levers.\n         * Controller numbers 120-127 are reserved as \"Channel Mode Messages\".\n         * @param controller the controller number\n         * @param value the value\n         */\n        //% blockId=midi_control_change block=\"%this|control change %key|to %pressure\"\n        //% blockGap=8\n        //% group=\"Channels\"\n        //% fn.min=0 fn.max=119\n        //% value.min=0 value.max=127\n        controlChange(fn: number, value: number) {\n            fn = fn >> 0;\n            value = value >> 0;\n            sendMessage([0xb0 | this.channel, fn & 0x7f, value & 0x7f]);\n        }\n\n        /**\n         * Channel mode control Change.\n         * @param mode the channel mode change\n         */\n        //% blockId=midi_channel_mode block=\"%this|mode %mode\"\n        //% blockGap=8\n        //% group=\"Channels\"\n        channelMode(mode: MidiChannelMode) {\n            sendMessage([0xb0 | this.channel, (mode >> 8) & 0x7f, mode & 0x7f]);\n        }\n    }\n\n    /**\n     * Plays a tone on channel 0\n     * @param frequency frequency of the note that will be mapped to a key\n     * @param duration duration of the note\n     */\n    //% blockId=midi_play_tone block=\"midi play|tone %frequency=device_note|for %duration=device_beat\" blockGap=8\n    //% weight=91\n    //% group=\"Play\"\n    export function playTone(frequency: number, duration: number): void {\n        channel(1).note(frequencyToKey(frequency), duration);\n    }\n\n    /**\n     * Turns on a note on channel 1\n     * @param frequency frequency of the note that will be mapped to a key\n     */\n    //% blockId=midi_tone_on block=\"midi tone on %frequency=device_note\" blockGap=8\n    //% weight=70\n    //% group=\"Play\"\n    export function toneOn(frequency: number): void {\n        channel(1).noteOn(frequencyToKey(frequency));\n    }\n\n    /**\n     * Turns off a note on channel 1\n     * @param frequency frequency of the note that will be mapped to a key\n     */\n    //% blockId=midi_tone_off block=\"midi tone off %frequency=device_note\"\n    //% weight=70\n    //% group=\"Play\"\n    export function toneOff(frequency: number): void {\n        channel(1).noteOff(frequencyToKey(frequency));\n    }\n\n    /**\n     * Applies a pitch bend effect to channel **1**.\n     * @param bend the amount of bending to be applied on channel **1**, eg: 8192\n     */\n    //% blockId=midi_pitch_bend block=\"midi pitch bend %bend\"\n    //% bend.min=0 bend.max=16383\n    //% group=\"Play\"\n    export function pitchBend(bend: number): void {\n        channel(1).pitchBend(bend);\n    }\n\n    /**\n     * Maps a frequency to a note key\n     * @param frequency\n     */\n    //% blockId=midi_frequency_to_key block=\"key at %frequency=device_note\" useEnumVal=1\n    //% weight=4 blockGap=8\n    //% group=\"Constants\"\n    export function frequencyToKey(frequency: number): number {\n        frequency = frequency | 0;\n        const log2 = 0.6931471805599453;\n        return Math.max(0, \n            Math.min(127, \n            Math.round(Math.log(frequency/440.0) / log2 * 12 + 69))\n        );\n    }\n\n    /**\n     * Plays a drum sound on channel **10**\n     * @param key index of the sound\n     */\n    //% blockId=midi_drum block=\"midi play drum %key=midi_drum_sound\"\n    //% weight=90\n    //% group=\"Play\"\n    export function playDrum(key: number): void {\n        channel(10).noteOn(key);\n    }\n\n    /**\n     * Selects a drum sound\n     * @param drumSound the type of sound\n     */\n    //% blockId=midi_drum_sound block=\"%sound\"\n    //% shim=TD_ID weight=5 blockGap=8\n    //% group=\"Constants\"\n    export function drumSound(sound: DrumSound): number {\n        return sound;\n    }\n\n    /**\n     * Selects an instrument\n     */\n    //% blockId=midi_instrument block=\"$i\"\n    //% shim=TD_ID weight=4 blockGap=8\n    //% group=\"Constants\"\n    export function instrument(i: MidiInstrument): number {\n        return i;\n    }\n\n    /**\n     * Selects a command\n     */\n    //% blockId=midi_command_id block=\"$c\"\n    //% shim=TD_ID weight=3 blockGap=8\n    //% group=\"Constants\"\n    export function command(c: MidiCommand): number {\n        return c;\n    }\n}\n","drums.ts":"enum DrumSound {\n    //% block=\"Acoustic Bass Drum\" enumval=35 blockIdentity=\"midi.drumSound\"\n    AcousticBassDrum = 35,\n    //% block=\"Bass Drum 1\" enumval=36 blockIdentity=\"midi.drumSound\"\n    BassDrum1 = 36,\n    //% block=\"Side Stick\" enumval=37 blockIdentity=\"midi.drumSound\"\n    SideStick = 37,\n    //% block=\"Acoustic Snare\" enumval=38 blockIdentity=\"midi.drumSound\"\n    AcousticSnare = 38,\n    //% block=\"Hand Clap\" enumval=39 blockIdentity=\"midi.drumSound\"\n    HandClap = 39,\n    //% block=\"Electric Snare\" enumval=40 blockIdentity=\"midi.drumSound\"\n    ElectricSnare = 40,\n    //% block=\"Low Floor Tom\" enumval=41 blockIdentity=\"midi.drumSound\"\n    LowFloorTom = 41,\n    //% block=\"Closed Hi Hat\" enumval=42 blockIdentity=\"midi.drumSound\"\n    ClosedHiHat = 42,\n    //% block\"High Floor Tom\" enumval=43 blockIdentity=\"midi.drumSound\"\n    HighFloorTom = 43,\n    //% block=\"Pedal Hi-Hat\" enumval=44 blockIdentity=\"midi.drumSound\"\n    PedalHiHat = 44,\n    //% block=\"Low Tom\" enumval=45 blockIdentity=\"midi.drumSound\"\n    LowTom = 45,\n    //% block=\"Open Hi-Hat\" enumval=46 blockIdentity=\"midi.drumSound\"\n    OpenHiHat = 46,\n    //% block=\"Low-Mid Tom\" enumval=47 blockIdentity=\"midi.drumSound\"\n    LowMidTom = 47,\n    //% block=\"Hi-Mid Tom\" enumval=48 blockIdentity=\"midi.drumSound\"\n    HiMidTom = 48,\n    //% block=\"Crash Cymbal 1\" enumval=49 blockIdentity=\"midi.drumSound\"\n    CrashCymbal1 = 49,\n    //% block=\"High Tom\" enumval=50 blockIdentity=\"midi.drumSound\"\n    HighTom = 50,\n    //% block=\"Ride Cymbal 1\" enumval=51 blockIdentity=\"midi.drumSound\"\n    RideCymbal1 = 51,\n    //% block=\"Chinese Cymbal\" enumval=52 blockIdentity=\"midi.drumSound\"\n    ChineseCymbal = 52,\n    //% block=\"Ride Bell\" enumval=53 blockIdentity=\"midi.drumSound\"\n    RideBell = 53,\n    //% block=\"Tambourine\" enumval=54 blockIdentity=\"midi.drumSound\"\n    Tambourine = 54,\n    //% block=\"Splash Cymbal\" enumval=55 blockIdentity=\"midi.drumSound\"\n    SplashCymbal = 55,\n    //% block=\"Cowbell\" enumval=56 blockIdentity=\"midi.drumSound\"\n    Cowbell = 56,\n    //% block=\"Crash Cymbal 2\" enumval=57 blockIdentity=\"midi.drumSound\"\n    CrashCymbal2 = 57,\n    //% block=\"Vibraslap\" enumval=58 blockIdentity=\"midi.drumSound\"\n    Vibraslap = 58,\n    //% block=\"Ride Cymbal 2\" enumval=59 blockIdentity=\"midi.drumSound\"\n    RideCymbal2 = 59,\n    //% block=\"Hi Bongo\" enumval=60 blockIdentity=\"midi.drumSound\"\n    HiBongo = 60,\n    //% block=\"Low Bongo\" enumval=61 blockIdentity=\"midi.drumSound\"\n    LowBongo = 61,\n    //% block=\"Mute Hi Conga\" enumval=62 blockIdentity=\"midi.drumSound\"\n    MuteHiConga = 62,\n    //% block=\"Open Hi Conga\" enumval=63 blockIdentity=\"midi.drumSound\"\n    OpenHiConga = 63,\n    //% block=\"Low Conga\" enumval=64 blockIdentity=\"midi.drumSound\"\n    LowConga = 64,\n    //% block=\"High Timbale\" enumval=65 blockIdentity=\"midi.drumSound\"\n    HighTimbale = 65,\n    //% block=\"Low Timbale\" enumval=66 blockIdentity=\"midi.drumSound\"\n    LowTimbale = 66,\n    //% block=\"High Agogo\" enumval=67 blockIdentity=\"midi.drumSound\"\n    HighAgogo = 67,\n    //% block=\"Low Agogo\" enumval=68 blockIdentity=\"midi.drumSound\"\n    LowAgogo = 68,\n    //% block=\"Cabasa\" enumval=69 blockIdentity=\"midi.drumSound\"\n    Cabasa = 69,\n    //% block=\"Maracas\" enumval=70 blockIdentity=\"midi.drumSound\"\n    Maracas = 70,\n    //% block=\"Short Whistle\" enumval=71 blockIdentity=\"midi.drumSound\"\n    ShortWhistle = 71,\n    //% block=\"Long Whistle\" enumval=72 blockIdentity=\"midi.drumSound\"\n    LongWhistle = 72,\n    //% block=\"Short Guiro\" enumval=73 blockIdentity=\"midi.drumSound\"\n    ShortGuiro = 73,\n    //% block=\"Long Guiro\" enumval=74 blockIdentity=\"midi.drumSound\"\n    LongGuiro = 74,\n    //% block=\"Claves\" enumval=75 blockIdentity=\"midi.drumSound\"\n    Claves = 75,\n    //% block=\"Hi Wood Block\" enumval=76 blockIdentity=\"midi.drumSound\"\n    HiWoodBlock = 76,\n    //% block=\"Low Wood Block\" enumval=77 blockIdentity=\"midi.drumSound\"\n    LowWoodBlock = 77,\n    //% block=\"Mute Cuica\" enumval=78 blockIdentity=\"midi.drumSound\"\n    MuteCuica = 78,\n    //% block=\"Open Cuica\" enumval=79 blockIdentity=\"midi.drumSound\"\n    OpenCuica = 79,\n    //% block=\"Mute Triangle\" enumval=80 blockIdentity=\"midi.drumSound\"\n    MuteTriangle = 80,\n    //% block=\"Open Triangle\" enumval=81 blockIdentity=\"midi.drumSound\"\n    OpenTriangle = 81,\n}\n","tests.ts":"// tests go here; this will not be compiled when this package is used as a library\nmidi.playTone(400, 500);\nfor (let i = 0; i < 127; ++i)\n    midi.playDrum(i)\nlet i = midi.channel(1);\ni.setInstrument(MidiInstrument.Banjo);\n\nlet piano = midi.channel(0);\nlet trumpet = midi.channel(1);\npiano.setInstrument(MidiInstrument.Trumpet);\n\nserial.writeLine('B ' + Note.B + ' -> ' + midi.frequencyToKey(Note.B))\n"}}